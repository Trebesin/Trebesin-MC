{"version":3,"sources":["plugins/server/server.js"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["//APIs:\nimport {world,system,MinecraftEffectTypes,MolangVariableMap} from '@minecraft/server';\nimport * as Debug from './../debug/debug';\n//MC modules\nimport * as Particles from './../../mc_modules/particles';\nimport { sendMessage } from '../../mc_modules/players';\nimport { FACE_DIRECTIONS } from '../../mc_modules/constants';\n//JS modules\nimport { randInt } from '../../js_modules/random';\nimport { setVectorLength, sumVectors } from '../../js_modules/vector';\nimport { DB } from '../backend/backend';\nimport { isAdmin } from '../commands/workers/admin';\n\nexport const playerData = {\n    instaKill: {}\n};\n\nexport const name = 'Server';\nexport async function main() {\n    system.runInterval(() => {\n        for (const player of world.getPlayers()) {\n            player.addEffect(MinecraftEffectTypes.saturation,9999,128,false);\n            if(!player.hasTag(\"nvoff\")) player.addEffect(MinecraftEffectTypes.nightVision,300,128,false);\n        }\n    },20);\n\n    system.runInterval(() => {\n        for (const player of world.getPlayers()) {\n            if (playerData.instaKill[player.id]) {\n                const molang = new MolangVariableMap()\n                .setColorRGBA('variable.color',{red:1,green:0,blue:0,alpha:1});\n                const location = sumVectors(setVectorLength(player.getViewDirection(),2),player.getHeadLocation());\n                player.dimension.spawnParticle(\n                    'trebesin:selection_dot_fast',\n                    location,\n                    molang\n                );\n            };\n\n            const equipedItem = player.getComponent('inventory').container.getSlot(player.selectedSlot).getItem();\n            if (equipedItem.typeId === 'trebesin:cmd_phaser') {\n                const molang = new MolangVariableMap()\n                .setColorRGBA('variable.color',{red:0,green:1,blue:1,alpha:1});\n                Particles.spawnLine(\n                    'trebesin:selection_dot_fast',\n                    [\n                        player.location,\n                        sumVectors(setVectorLength(player.getViewDirection(),2),player.getHeadLocation())\n                    ],\n                    player.dimension,\n                    molang,\n                    0.25\n                );\n            };\n        }\n    },4);\n\n    world.afterEvents.entityHit.subscribe((eventData) => {\n        const {entity,hitEntity} = eventData;\n        if (hitEntity && entity.typeId === 'minecraft:player' && playerData.instaKill[entity.id]) {\n            hitEntity.kill();\n            playerData.instaKill[entity.id] = false;\n        }\n    })\n\n    world.afterEvents.playerJoin.subscribe(async (eventData) => {\n        const connection = DB;\n        const request = {\n            sql: 'INSERT INTO PlayerConnections (playerID,PlayerName,Tick) VALUES (?,?,?);',\n            values: [eventData.playerId, eventData.playerName, system.currentTick]\n        }\n        try {\n            await connection.query(request,true);\n        } catch (error) {\n            Debug.logMessage(`${error}`);\n        }\n    });\n\n    //## Block Ban\n    world.beforeEvents.itemUseOn.subscribe((eventData) => {\n        if (eventData.source.hasTag('certified_builder')) return;\n        const itemId = eventData.itemStack.typeId;\n        if (\n            itemId === 'minecraft:lava_bucket' ||\n            itemId === 'minecraft:lava' ||\n            itemId === 'minecraft:flowing_lava' || \n            itemId === 'minecraft:dragon_egg'\n        ) {\n            sendMessage(`§cYou are not permitted to use the item ${itemId}!§r`,'SERVER',eventData.source);\n            if(isAdmin(eventData.source))sendMessage(`§a You hovewer do have the permissions to place lava buckets. Use !allowbuild @s to grant them§r\\n`,'SERVER',eventData.source);\n            eventData.cancel = true;\n        }\n    });\n}"]}
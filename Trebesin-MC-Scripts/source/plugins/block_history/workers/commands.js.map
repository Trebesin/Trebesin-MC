{"version":3,"sources":["plugins/block_history/workers/commands.js"],"names":[],"mappings":"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","file":"commands.js","sourcesContent":["//APIs:\r\nimport {CommandResult, MinecraftEffectTypes , world, TicksPerDay, TicksPerSecond, MolangVariableMap, system, MinecraftBlockTypes, BlockPermutation, Player} from \"@minecraft/server\";\r\n//Plugins:\r\nimport * as BlockHistoryPlugin from \"../block_history\";\r\nimport { Commands, sendLongMessage, DB } from '../../backend/backend';\r\nimport { isAdmin, isMod } from \"../../commands/workers/admin\";\r\nimport { logMessage, sendLogMessage } from \"../../debug/debug\";\r\n//sdf\r\n//Modules:\r\nimport * as VectorMath from '../../../js_modules/vectorMath'\r\nimport * as Blocks from \"../../../mc_modules/blocks\";\r\nimport { sendMessage} from \"../../../mc_modules/players\";\r\nimport { getEdgeLocations, locationToString, stringToLocation } from \"../../../mc_modules/particles\";\r\nimport { CommandError } from \"../../../mc_modules/commandParser\";\r\n\r\n//const {BlockHistoryUpdateTypes,BlockHistoryUpdateTypeNames} = BlockHistoryPlugin;\r\n\r\n/**\r\n * Object with defining IDs for `BlockHistoryOptions` `updateType` entries.\r\n */\r\nconst BlockHistoryUpdateTypes = {\r\n    /** Block updated by a player in a usual vanilla MC interaction. */\r\n    playerUpdate: 0,\r\n    /** Block updated by a player using block history plugin reverse feature. */\r\n    blockHistoryReverse: 1,\r\n    /** Block updated by a player using blocky tools plugin. */\r\n    blockyTools: 2,\r\n    /** Block updated by the system for a technical reason in an automated fashion. */\r\n    system: 3\r\n\r\n};\r\n\r\nconst BlockHistoryUpdateTypeNames = [\r\n    'Player Update',\r\n    'Block History: Reverse',\r\n    'Blocky Tools: Player',\r\n    'System'\r\n];\r\n\r\n\r\nlet particlesPerPlayers = {}\r\nlet confirmationPerPlayer = {}\r\nlet lastParticleCall = {}\r\nlet lastCall = {}\r\nconst PARTICLE_LIMIT = 1000//particle limit per player\r\n\r\nexport function main(){\r\n    system.runInterval(() => {\r\n        for (const player in particlesPerPlayers) {\r\n            //## Particles:\r\n            let limitIndex = 0;\r\n            for(const locationString of particlesPerPlayers[player].particleLocations){\r\n                if(limitIndex > PARTICLE_LIMIT){\r\n                    sendMessage(\"§c§lTOO MANY PARTICLES §r- removing all your particles\", \"§cBH - CHAOS MANAGER\",particlesPerPlayers[player].player)\r\n                    delete particlesPerPlayers[player];\r\n                    break;\r\n                }\r\n                limitIndex++\r\n                const particleLocation = stringToLocation(locationString);\r\n                spawnParticles(particleLocation[0], particleLocation[1], particlesPerPlayers[player].player);\r\n            }\r\n        }\r\n        for(const player in confirmationPerPlayer) {\r\n            if (!confirmationPerPlayer[player].confirmed && confirmationPerPlayer[player].countdown > 0) {\r\n                confirmationPerPlayer[player].countdown - 4;\r\n            }\r\n            else if(confirmationPerPlayer[player].confirmed) {\r\n                try {\r\n                    confirmationPerPlayer[player].callback();\r\n                } catch(error) {\r\n                    logMessage(error);\r\n                }\r\n                delete confirmationPerPlayer[player];\r\n            }\r\n            else {\r\n                sendMessage('The confirmation has expired!', 'blockHistory', confirmationPerPlayer[player].player)\r\n                delete confirmationPerPlayer[player];\r\n            }\r\n        }\r\n    },4);\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     * @param {Player} sender \r\n     * @param {*} parameter \r\n     */\r\n    async function blockHistoryHandler(sender, parameter){\r\n        switch(parameter.command){\r\n            case 'warp':\r\n                if(!lastCall[sender.id]){\r\n                    sendMessage(\"there is nothing to warp to\", \"blockHistory\", sender)\r\n                }\r\n                {\r\n                    const index = parameter.index ?? 1\r\n                    if(index < 0 || index >= lastCall[sender.id].length){\r\n                        sendMessage('invalid index', 'blockHistory', sender)\r\n                    }\r\n                    sender.teleport(lastCall[sender.id][index-1]);\r\n                }\r\n                break;\r\n            case 'rb':\r\n            case 'reverseblock':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    const pos = VectorMath.floor(parameter.coords ?? sender.location);\r\n                    let request = {};\r\n                    try{\r\n                        request = sqlRequestHandler(parameter, {type: \"block\", pos: pos})\r\n                    }\r\n                    catch(error){\r\n                        sendMessage(`invalid until/startingFrom parameter: ${error}`, \"blockHistory\", sender)\r\n                        break;\r\n                    }\r\n                    const response = await DB.query(request);\r\n\r\n                    if(!response.result[0]?.x && response.result != \"\"){\r\n                        sendMessage('§c critical Mysql error. Contact admins for fix', 'BlockHistory', sender)\r\n                        sendLogMessage(JSON.stringify(response.result))\r\n                        break;\r\n                    }\r\n\r\n                    if(!printBlockHistory(response, {type: \"block\", pos: pos}, sender))break;\r\n\r\n                    lastCall[sender.id] = response.result\r\n                    sendMessage('You can use !bh warp [index] to warp to a block', \"blockHistory\", sender)\r\n\r\n                    if(parameter.particles ?? false){\r\n                        getEdgeLocations([pos], (loc,axis) => {\r\n                            addActiveParticles(loc,axis,sender);\r\n                        })\r\n                    }\r\n                    else{\r\n                        if(lastParticleCall[sender.id])delete lastParticleCall[sender.id]\r\n                        sendMessage(`you can use !bh show to see these changes using particles`, \"blockHistory\", sender)\r\n                        lastParticleCall[sender.id] = {\r\n                            callback: () => {\r\n                                getEdgeLocations([pos], (loc,axis) => {\r\n                                    addActiveParticles(loc,axis,sender);\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                    sendMessage(`are you sure you want to reverse these changes?\\n - !bh confirm to confirm or !bh cancel to cancel`,'blockHistory',sender);\r\n\r\n                    if(confirmationPerPlayer[sender.id]) delete confirmationPerPlayer[sender.id];\r\n                    confirmationPerPlayer[sender.id] = {\r\n                        player: sender,\r\n                        confirmed: false,\r\n                        callback: () => {\r\n                            reverseBlocks(response.result, sender)\r\n                        },\r\n                        countdown: 1200\r\n                    };\r\n                }\r\n                break;\r\n            case \"show\":\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    if(lastParticleCall[sender.id]){\r\n                        lastParticleCall[sender.id].callback()\r\n                        delete lastParticleCall[sender.id]\r\n                        sendMessage(\"showing particles..\", \"blockHistory\", sender)\r\n                    }\r\n                    else sendMessage(\"there is nothing to show\", \"blockHistory\", sender)\r\n                }\r\n                break;\r\n            case 'b':\r\n            case 'block':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    const pos = VectorMath.floor(parameter.coords ?? sender.location);\r\n                    let request = {}\r\n                    try{\r\n                        request = sqlRequestHandler(parameter, {type: \"block\", pos: pos})\r\n                    }\r\n                    catch(error){\r\n                        sendMessage(`invalid until/startingFrom parameter: ${error}`, \"blockHistory\", sender)\r\n                        break;\r\n                    }\r\n                    const response = await DB.query(request);\r\n\r\n                    if(!response.result[0]?.x && response.result != \"\"){\r\n                        sendMessage('§c critical Mysql error. Contact admins for fix', 'BlockHistory', sender)\r\n                        sendLogMessage(JSON.stringify(response.result))\r\n                        break;\r\n                    }\r\n\r\n                    if(!printBlockHistory(response, {type: \"block\", pos: pos}, sender))break;\r\n\r\n                    lastCall[sender.id] = response.result\r\n                    sendMessage('You can use !bh warp [index] to warp to a block', \"blockHistory\", sender)\r\n\r\n                    if(parameter.particles ?? false){\r\n                            getEdgeLocations([pos], (loc,axis) => {\r\n                                addActiveParticles(loc,axis,sender);\r\n                            })\r\n                    }\r\n                    else{\r\n                        if(lastParticleCall[sender.id])delete lastParticleCall[sender.id]\r\n                        sendMessage(`you can use !bh show to see these changes using particles`, \"blockHistory\", sender)\r\n                        lastParticleCall[sender.id] = {\r\n                            callback: () => {\r\n                                getEdgeLocations([pos], (loc,axis) => {\r\n                                    addActiveParticles(loc,axis,sender);\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            case 'p':\r\n            case 'player':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    const playerName = parameter.player ?? sender.name\r\n                    let request = {}\r\n                    try{\r\n                        request = sqlRequestHandler(parameter, {type: \"player\", playerName: playerName})\r\n                    }\r\n                    catch(error){\r\n                        sendMessage(`invalid until/startingFrom parameter: ${error}`, \"\", sender)\r\n                        break;\r\n                    }\r\n                    const response = await DB.query(request);\r\n                    \r\n                    if(!response.result[0]?.x && response.result != \"\"){\r\n                        sendMessage('§c critical Mysql error. Contact admins for fix', 'BlockHistory', sender)\r\n                        sendLogMessage(JSON.stringify(response.result))\r\n                        break;\r\n                    }\r\n\r\n\r\n                    if(!printBlockHistory(response, {type: \"player\"}, sender))break;\r\n\r\n                    lastCall[sender.id] = response.result\r\n                    sendMessage('You can use !bh warp [index] to warp to a block', \"blockHistory\", sender)\r\n\r\n                    if(parameter.particles ?? false){\r\n                        getEdgeLocations(response.result, (loc,axis) => {\r\n                            addActiveParticles(loc,axis,sender);\r\n                        })\r\n                    }\r\n                    else{\r\n                        if(lastParticleCall[sender.id])delete lastParticleCall[sender.id]\r\n                        sendMessage(`you can use !bh show to see these changes using particles`, \"blockHistory\", sender)\r\n                        lastParticleCall[sender.id] = {\r\n                            callback: () => {\r\n                                getEdgeLocations(response.result, (loc,axis) => {\r\n                                    addActiveParticles(loc,axis,sender);\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            case 'redo':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    const playerName = parameter.player ?? sender.name\r\n                    const request = {\r\n                        sql : `\r\n                            SELECT DISTINCT block_history.*, PlayerConnections.PlayerName \r\n                            FROM \\`block_history\\` \r\n                            JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                                FROM PlayerConnections \r\n                                GROUP BY PlayerID) AS latest_connections \r\n                            ON block_history.actor_id = latest_connections.PlayerID \r\n                            JOIN PlayerConnections \r\n                            ON latest_connections.latest_id = PlayerConnections.ID\r\n                            WHERE PlayerName = ? AND update_type = ${BlockHistoryUpdateTypes.blockHistoryReverse} AND update_id = ?\r\n                            ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n                        `,\r\n                        values : [playerName, parameter.id]\r\n                    }\r\n                    const response = await DB.query(request);\r\n\r\n                    if(!response.result[0]?.x && response.result != \"\"){\r\n                        sendMessage('§c critical Mysql error. Contact admins for fix', 'BlockHistory', sender)\r\n                        sendLogMessage(JSON.stringify(response.result))\r\n                        break;\r\n                    }\r\n\r\n                    if(!printBlockHistory(response, {type: \"reverse\"}, sender))break;\r\n\r\n                    lastCall[sender.id] = response.result\r\n                    sendMessage('You can use !bh warp [index] to warp to a block', \"blockHistory\", sender)\r\n\r\n                    if(parameter.particles ?? false){\r\n                        getEdgeLocations(response.result, (loc,axis) => {\r\n                            addActiveParticles(loc,axis,sender);\r\n                        })\r\n                    }\r\n                    else{\r\n                        if(lastParticleCall[sender.id])delete lastParticleCall[sender.id]\r\n                        sendMessage(`you can use !bh show to see these changes using particles`, \"blockHistory\", sender)\r\n                        lastParticleCall[sender.id] = {\r\n                            callback: () => {\r\n                                getEdgeLocations(response.result, (loc,axis) => {\r\n                                    addActiveParticles(loc,axis,sender);\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    sendMessage(`are you sure you want to revert these changes?\\n - !bh confirm to confirm or !bh cancel to cancel`,'blockHistory',sender);\r\n\r\n                    if(confirmationPerPlayer[sender.id]) delete confirmationPerPlayer[sender.id];\r\n                    confirmationPerPlayer[sender.id] = {\r\n                        player: sender,\r\n                        confirmed: false,\r\n                        callback: () => {\r\n                            reverseBlocks(response.result, sender)\r\n                        },\r\n                        countdown: 1200\r\n                    };\r\n                }\r\n                break;\r\n            case 'r':\r\n            case 'reverse':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    const playerName = parameter.player ?? sender.name\r\n                    let request = {}\r\n                    try{\r\n                        request = sqlRequestHandler(parameter, {type: \"player\", playerName: playerName})\r\n                    }\r\n                    catch(error){\r\n                        sendMessage(`invalid until/startingFrom parameter: ${error}`, \"blockHistory\", sender)\r\n                        break;\r\n                    }\r\n                    const response = await DB.query(request);\r\n\r\n                    if(!response.result[0]?.x && response.result != \"\"){\r\n                        sendMessage('§c critical Mysql error. Contact admins for fix', 'BlockHistory', sender)\r\n                        sendLogMessage(JSON.stringify(response.result))\r\n                        break;\r\n                    }\r\n\r\n                    if(!printBlockHistory(response, {type: \"player\"}, sender))break;\r\n\r\n                    lastCall[sender.id] = response.result\r\n                    sendMessage('You can use !bh warp [index] to warp to a block', \"blockHistory\", sender)\r\n\r\n                    if(parameter.particles ?? false){\r\n                        getEdgeLocations(response.result, (loc,axis) => {\r\n                            addActiveParticles(loc,axis,sender);\r\n                        })\r\n                    }\r\n                    else{\r\n                        if(lastParticleCall[sender.id])delete lastParticleCall[sender.id]\r\n                        sendMessage(`you can use !bh show to see these changes using particles`, \"blockHistory\", sender)\r\n                        lastParticleCall[sender.id] = {\r\n                            callback: () => {\r\n                                getEdgeLocations(response.result, (loc,axis) => {\r\n                                    addActiveParticles(loc,axis,sender);\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    sendMessage(`are you sure you want to reverse these changes?\\n - !bh confirm to confirm or !bh cancel to cancel`,'blockHistory',sender);\r\n\r\n                    if(confirmationPerPlayer[sender.id]) delete confirmationPerPlayer[sender.id];\r\n                    confirmationPerPlayer[sender.id] = {\r\n                        player: sender,\r\n                        confirmed: false,\r\n                        callback: () => {\r\n                            reverseBlocks(response.result, sender)\r\n                        },\r\n                        countdown: 1200\r\n                    };\r\n                }\r\n                break;\r\n            case 'confirm':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    try {\r\n                        confirmationPerPlayer[sender.id].confirmed = true\r\n                    }\r\n                    catch {\r\n                        sendMessage('the confirmation has expired!', 'blockHistory', sender)\r\n                    }\r\n                }\r\n                break;\r\n            case 'i':\r\n            case 'inspector':\r\n                {\r\n                    if(!sender.hasTag(\"inspector\")) {\r\n                        sender.addTag(\"inspector\");\r\n                        sendMessage(\"inspector is now turned on, right click a block with your hand or place any block to see its history\\n\", \"blockHistory\", sender);\r\n                    }\r\n                    else {\r\n                        sender.removeTag(\"inspector\");\r\n                        sendMessage(\"inspector is now turned off\", \"blockHistory\", sender);\r\n                    };\r\n                }\r\n                break;\r\n            case 'cancel':\r\n                if(!confirmationPerPlayer[sender.id]){\r\n                    sendMessage(\"there is nothing to be canceled\", \"blockHistory\", sender)\r\n                    break;\r\n                }\r\n                delete confirmationPerPlayer[sender.id]\r\n                sendMessage(\"The call is now aborted\", \"blockHistory\", sender)\r\n                break;\r\n            case 'c':\r\n            case 'clear':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                {\r\n                    if(parameter.players){\r\n                        for(let i = 0;i<parameter.players.length; i++){\r\n                            const player = parameter.players[i]\r\n                            removeActiveParticles(player)\r\n                        }\r\n                    } else {\r\n                        removeActiveParticles(sender);\r\n                    }\r\n                }\r\n                break;\r\n            case 'ca':\r\n            case 'clearall':\r\n                if(!isMod(sender)){\r\n                    sendMessage('sorry you don\\'t have permision to use this command. use !bh help for available commands')\r\n                    break;\r\n                }\r\n                removeAllActiveParticles();\r\n                break;\r\n            default:\r\n                if(isAdmin(sender)){\r\n                    sendLongMessage(`blockHistory: help`,\r\n                        `\r\n    b/block - shows the changes made to block on [x], [y], [z] - parameters: until, startingFrom, location: x, location: y, location: z, allowParticles\r\n    p/player - shows the changes made by a player - parameters: until, startingFrom, player, allowParticles\r\n    i/inspect - gets you into inspector mode - when you place blocks it doesn't place them and instead shows you the changes made to that block\r\n    r/reverse - reverses actions of a player in specific time frame - parameters: until, startingFrom, player, allowParticles\r\n    rb/reverseblock - reverses a block to it's older state - parameters: until, startingFrom, location: x, location: y, location: z, allowParticles\r\n    bt/blockytools - show history of blockytools edits - parameters: until, startingFrom, player -- not ready yet\r\n    rbt/reversebt/reverseblockytools - reverses a blockytools edit using its id - parameters: until, startingFrom, player -- not ready yet\r\n    redo - reverses an action made by this plugin - parameters: ID, player, allowParticles\r\n    c/clear - clears all the particles generated by this plugin by a player\r\n    ca/clearall - clears all the particles generated by this plugin by everyone\r\n                        `,sender);\r\n                }\r\n\r\n                else if(isMod(sender)){\r\n                    sendMessage(`blockHistory: help`\r\n                        `\r\n    b/block - shows the changes made to block on [x], [y], [z] - parameters: until, startingFrom, location: x, location: y, location: z, allowParticles\r\n    p/player - shows the changes made by a player - parameters: until, startingFrom, player, allowParticles\r\n    r/reverse - reverses actions of a player in specific time frame - parameters: until, startingFrom, player, allowParticles\r\n    rb/reverseblock - reverses a block to it's older state - parameters: until, startingFrom, location: x, location: y, location: z, allowParticles\r\n    bt/blockytools - show history of blockytools edits - parameters: until, startingFrom, player -- not ready yet\r\n    rbt/reversebt/reverseblockytools - reverses a blockytools edit using its id - parameters: until, startingFrom, player -- not ready yet\r\n    redo - reverses an action made by this plugin - parameters: ID, player, allowParticles\r\n    c/clear - clears all the particles generated by this plugin by a player\r\n    ca/clearall - clears all the particles generated by this plugin by everyone\r\n                        `, sender);\r\n                }\r\n\r\n                else {\r\n                    sendLongMessage(`blockHistory: help`\r\n                        `\r\n    i/inspector - gets you into inspector mode: place blocks or right click with hand to see changes\r\n                        `, sender\r\n                    )\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n  Commands.registerCommand(\"bh\", {\r\n    parameters: [\r\n        {id: \"command\", type: \"string\", optional: true, choice: {\r\n                b: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'pos',id:'coords',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                warp: [\r\n                    {type: 'int', id: 'index', optional: true}\r\n                ],\r\n                block: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'pos',id:'coords',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                show: [\r\n\r\n                ],\r\n                p: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'string',id:'player',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                player: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'string',id:'player',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                c: [\r\n                    {type: 'selector', id: 'players', optional:true, playerOnly:true}\r\n                ],\r\n                clear: [\r\n                    {type: 'selector', id: 'players', optional:true, playerOnly:true}\r\n                ],\r\n                ca: [\r\n\r\n                ],\r\n                clearall: [\r\n\r\n                ],\r\n                i: [\r\n\r\n                ],\r\n                inspector: [\r\n\r\n                ],\r\n                r: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'string',id:'player',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                redo: [\r\n                    {type:'int',id:'id'},\r\n                    {type:'string',id:'player',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                reverse: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'string',id:'player',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                rb: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'pos',id:'coords',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                reverseblock: [\r\n                    {type:'str',id:'until',optional:true},\r\n                    {type:'str',id:'startingFrom',optional:true},\r\n                    {type:'pos',id:'coords',optional:true},\r\n                    {type:'bool',id:'particles', optional:true}\r\n                ],\r\n                confirm: [\r\n                ],\r\n                help: [\r\n                ],\r\n                h: [\r\n                ],\r\n                \"?\": [\r\n                ],\r\n                cancel: [\r\n                ]\r\n                \r\n            }\r\n        }\r\n    ], aliases: [\"blockhistory\", \"co\", \"coreprotect\"], run: blockHistoryHandler, senderCheck: isMod, description: `manage/view player blockHistory. view !bh help for detailed help`\r\n  })\r\n}\r\n\r\nfunction addActiveParticles(particleLocation, axis, sender) {\r\n    particlesPerPlayers[sender.id] ??= {\r\n        player: sender,\r\n        particleLocations: new Set()\r\n    };\r\n    particlesPerPlayers[sender.id].particleLocations.add(locationToString(particleLocation,axis));\r\n}\r\n\r\nfunction removeActiveParticles(sender) {\r\n    delete particlesPerPlayers[sender.id];\r\n}\r\n\r\nfunction removeAllActiveParticles() {\r\n    for (const player in particlesPerPlayers) {\r\n        delete particlesPerPlayers[player];\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nfunction sqlRequestHandler(parameters, options){\r\n    let request = {}\r\n    if(options.type === \"block\"){\r\n        if((!parameters.until || /^(\\d+)$/.exec(parameters.until)) && (!parameters.startingFrom || /^(\\d+)$/.exec(parameters.startingFrom))){\r\n            request = {//request for block where we have number until and number startFrom\r\n            sql: `\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName\r\n                FROM block_history \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE x = ? AND y = ? AND z = ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n                LIMIT ? OFFSET ?\r\n            `,\r\n            values : [options.pos.x, options.pos.y, options.pos.z,parseInt(parameters.until ?? 7), parseInt(parameters.startingFrom ?? 0)]\r\n            }\r\n        }\r\n        else if(/^(\\d+)(m|w|d|h|s)/.exec(parameters.until) && (!parameters.startingFrom || /^(\\d+)$/.exec(parameters.startingFrom))){\r\n            request = {//request for block where we have realtime until and startFrom number\r\n                sql : `\r\n                WITH cte AS (\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName, ROW_NUMBER() OVER (ORDER BY block_history.tick DESC) AS rn\r\n                FROM block_history \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE x = ? AND y = ? AND z = ? AND block_history.tick >= ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n                )\r\n                SELECT *\r\n                FROM cte\r\n                WHERE rn > ?\r\n                `,\r\n                values : [options.pos.x, options.pos.y, options.pos.z,system.currentTick - parseToTicks(parameters.until), parseInt(parameters.startingFrom ?? 0)]\r\n            }\r\n        }\r\n        else if(/^(\\d+)(m|w|d|h|s)/.exec(parameters.until) && /^(\\d+)(m|w|d|h|s)/.exec(parameters.startingFrom)){\r\n            request = {//request for block where we have realtime until and realtime startFrom\r\n            sql: `\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName\r\n                FROM block_history \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE x = ? AND y = ? AND z = ? AND block_history.tick >= ? AND block_history.tick <= ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n            `,\r\n            values : [options.pos.x, options.pos.y, options.pos.z,system.currentTick - parseToTicks(parameters.until), system.currentTick - parseToTicks(parameters.startingFrom)]\r\n            }\r\n        }\r\n        else if((!parameters.until || /^(\\d+)$/.exec(parameters.until)) && /^(\\d+)(m|w|d|h|s)/.exec(parameters.startingFrom)){\r\n            request = {//request for block where we have number until and realtime startFrom\r\n            sql: `\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName\r\n                FROM block_history \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE x = ? AND y = ? AND z = ? AND block_history.tick <= ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n                LIMIT ? OFFSET 0\r\n            `,\r\n            values : [options.pos.x, options.pos.y, options.pos.z,system.currentTick - parseToTicks(parameters.startingFrom), parseInt(parameters.until ?? 7)]\r\n            }\r\n        }\r\n        else{\r\n            throw new CommandError(\"invalid until/startingFrom parameter\")\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    \r\n\r\n\r\n    else if(options.type === \"player\"){\r\n        if((!parameters.until || /^(\\d+)$/.exec(parameters.until)) && (!parameters.startingFrom || /^(\\d+)$/.exec(parameters.startingFrom))){\r\n            request = {//request for player where we have number until and number startFrom\r\n                sql : `\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName \r\n                FROM \\`block_history\\` \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE PlayerName = ?  \r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n                LIMIT ? OFFSET ?\r\n                `,\r\n                values : [options.playerName, parseInt(parameters.until ?? 7), parseInt(parameters.startingFrom ?? 0)]\r\n            }\r\n        }\r\n        else if(/^(\\d+)(m|w|d|h|s)/.exec(parameters.until) && (!parameters.startingFrom || /^(\\d+)$/.exec(parameters.startingFrom))){\r\n            request = {//request for player where we have realtime until and startFrom number\r\n                sql : `\r\n                    WITH cte AS (\r\n                        SELECT block_history.*, PlayerConnections.PlayerName, ROW_NUMBER() OVER (ORDER BY block_history.tick DESC) AS rn\r\n                        FROM block_history\r\n                        JOIN (SELECT PlayerID, MAX(ID) AS latest_id\r\n                            FROM PlayerConnections\r\n                            GROUP BY PlayerID) AS latest_connections\r\n                        ON block_history.actor_id = latest_connections.PlayerID\r\n                        JOIN PlayerConnections\r\n                        ON latest_connections.latest_id = PlayerConnections.ID\r\n                        WHERE PlayerName = ? AND block_history.tick >= ?\r\n                    )\r\n                    SELECT *\r\n                    FROM cte\r\n                    WHERE rn > ?\r\n                `,\r\n                values : [options.playerName,system.currentTick - parseToTicks(parameters.until), parseInt(parameters.startingFrom ?? 0)]\r\n            }\r\n        }\r\n        else if(/^(\\d+)(m|w|d|h|s)/.exec(parameters.until) && /^(\\d+)(m|w|d|h|s)/.exec(parameters.startingFrom)){\r\n            request = {//request for player where we have realtime until and realtime startFrom\r\n            sql: `\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName\r\n                FROM block_history \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE playerName = ? AND block_history.tick >= ? AND block_history.tick <= ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n            `,\r\n            values : [options.playerName,system.currentTick - parseToTicks(parameters.until), system.currentTick - parseToTicks(parameters.startingFrom)]\r\n            }\r\n        }\r\n        else if((!parameters.until || /^(\\d+)$/.exec(parameters.until)) && /^(\\d+)(m|w|d|h|s)/.exec(parameters.startingFrom)){\r\n            request = {//request for player where we have number until and realtime startFrom\r\n            sql: `\r\n                SELECT DISTINCT block_history.*, PlayerConnections.PlayerName\r\n                FROM block_history \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE playerName = ? AND block_history.tick <= ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC\r\n                LIMIT ? OFFSET 0\r\n            `,\r\n            values : [options.playerName,system.currentTick - parseToTicks(parameters.startingFrom), parseInt(parameters.until ?? 7)]\r\n            }\r\n        }\r\n        else{\r\n            throw new CommandError(\"invalid until/startingFrom parameter\")\r\n        }\r\n    }\r\n    return request\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * \r\n * @param {Promise} request \r\n * @param {options} options \r\n * @returns \r\n */\r\n\r\nfunction printBlockHistory(request, options, sender){\r\n    const playerName = sender.name\r\n    if(request.result == \"\" && options.type === \"player\"){\r\n        sendMessage(`No changes were made by the player ${playerName}`,'CMD - BlockHistory',sender);\r\n        return false;\r\n    }\r\n    if(request.result == \"\" && options.type === \"reverse\"){\r\n        sendMessage(`No changes were made by blockhistory from ${playerName}`,'CMD - BlockHistory',sender);\r\n        return false;\r\n    }\r\n    if(request.result == \"\" && options.type === \"block\"){\r\n        sendMessage(`No changes were made to block ${Math.floor(options.pos.x)}, ${Math.floor(options.pos.y)}, ${Math.floor(options.pos.z)}`,'CMD - BlockHistory',sender);\r\n        return false;\r\n    }\r\n    const tickInASec = TicksPerSecond\r\n    const tickInAMin = tickInASec*60\r\n    const tickInAnHour = tickInAMin*60\r\n    const tickInADay = tickInAnHour*24\r\n    let message = ''\r\n    for(let i = 0; i < request.result.length; i++){\r\n        const blockAlteration = request.result[i]\r\n        const timeOfBlockAlteration = system.currentTick - parseInt(blockAlteration.tick)\r\n        if(options.type === \"player\" || options.type === \"reverse\"){\r\n            message += `${blockAlteration.update_type === BlockHistoryUpdateTypes.playerUpdate ? \"\" : `(${BlockHistoryUpdateTypeNames[blockAlteration.update_type]}) - `}[${blockAlteration.x}, ${blockAlteration.y}, ${blockAlteration.z}]: ${blockAlteration.before_id} -> ${blockAlteration.after_id} - before: ${parseToRealTime(timeOfBlockAlteration)}\\n`;\r\n        }\r\n        if(options.type === \"block\"){\r\n            message += `${blockAlteration.PlayerName}${blockAlteration.update_type === BlockHistoryUpdateTypes.playerUpdate ? \"\" : ` (${BlockHistoryUpdateTypeNames[blockAlteration.update_type]})`}: ${blockAlteration.before_id} -> ${blockAlteration.after_id} - before: ${parseToRealTime(timeOfBlockAlteration)}\\n`;\r\n        }\r\n    }\r\n    if(options.type === \"reverse\")sendLongMessage(`Block History reverses of ${playerName}`, message.trim(), sender)\r\n    if(options.type === \"player\")sendLongMessage(`Block History of ${playerName}`, message.trim(), sender);\r\n    if(options.type === \"block\")sendLongMessage(`Block History of block ${Math.floor(options.pos.x)}, ${Math.floor(options.pos.y)}, ${Math.floor(options.pos.z)}`, message.trim(), sender);\r\n    return true;\r\n}\r\n\r\nfunction spawnParticles(location, particleAxis, sender) {\r\n    const molang = new MolangVariableMap()\r\n    .setColorRGB('variable.color',{red:1,green:0,blue:0,alpha:1});\r\n    const dimension = world.getDimension('overworld');\r\n    dimension.spawnParticle(`trebesin:edge_highlight_${particleAxis}`, location, molang);\r\n}\r\n\r\nasync function getMaxIDPerPlayer(updateType, player){\r\n    try{\r\n        const request = await DB.query({\r\n            sql: `SELECT actor_id, MAX(update_id) AS id\r\n                    FROM block_history\r\n                    WHERE actor_id = ? AND update_type = ? AND update_id IS NOT NULL\r\n                    GROUP BY actor_id;\r\n                    `,\r\n            values: [player.id, updateType]\r\n        })\r\n        return request.result[0].id\r\n    }\r\n    catch(error){\r\n        logMessage(error)\r\n    }\r\n}\r\n\r\n/**\r\n * \r\n * @param {Blocks.BlockState} blockOld \r\n * @param {import('../../../mc_modules/dimensions').Position} position \r\n */\r\nexport function revertBlockChange(blockOld, position){\r\n    const block = position.dimension.getBlock(position.location);\r\n    Blocks.applyBlockState(block,blockOld);\r\n}\r\n\r\nfunction parseToRealTime(input){\r\n    let result = \"\"\r\n    const tickInASec = TicksPerSecond\r\n    const tickInAMin = tickInASec*60\r\n    const tickInAnHour = tickInAMin*60\r\n    const tickInADay = tickInAnHour*24\r\n    const tickInAWeek = tickInADay*7\r\n    const timers = [tickInAWeek, tickInADay, tickInAnHour, tickInAMin, tickInASec]\r\n    const timerletter = ['w', 'd', 'h', 'm', 's']\r\n    for(let i = 0;i<timers.length;i++){\r\n        if(!Math.floor(input/timers[i]))continue;\r\n        result += `${Math.floor(input/timers[i])}` + timerletter[i]\r\n        input = input%timers[i]\r\n    }\r\n    return result\r\n}\r\n\r\nfunction parseToTicks(input){\r\n    const regex = /^(\\d+)(m|w|d|h|s)/;\r\n    let result = 0\r\n    const tickInASec = TicksPerSecond\r\n    const tickInAMin = tickInASec*60\r\n    const tickInAnHour = tickInAMin*60\r\n    const tickInADay = tickInAnHour*24\r\n    const tickInAWeek = tickInADay*7\r\n    let workingString = input\r\n    while(workingString !== \"\"){\r\n        const string = regex.exec(workingString)\r\n        workingString = workingString.replace(regex, \"\")\r\n        if(!string)throw new CommandError(`couldn't parse ${input} to ticks!`)\r\n        switch (string[2]) {\r\n            case \"w\":\r\n                result += string[1]*tickInAWeek\r\n                break;\r\n            case \"d\":\r\n                result += string[1]*tickInADay\r\n                break;\r\n            case \"h\":\r\n                result += string[1]*tickInAnHour\r\n                break;\r\n            case \"m\":\r\n                result += string[1]*tickInAMin\r\n                break;\r\n            case \"s\":\r\n                result += string[1]*tickInASec\r\n                break;\r\n            default:\r\n                throw new CommandError(`couldn't parse ${input} to ticks!`)\r\n                break;\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nexport async function inspector(location, sender){\r\n    const pos = location \r\n    const request = {\r\n        sql : `SELECT DISTINCT block_history.*, PlayerConnections.PlayerName \r\n                FROM \\`block_history\\` \r\n                JOIN (SELECT PlayerID, MAX(ID) AS latest_id \r\n                        FROM PlayerConnections \r\n                        GROUP BY PlayerID) AS latest_connections \r\n                    ON block_history.actor_id = latest_connections.PlayerID \r\n                    JOIN PlayerConnections \r\n                    ON latest_connections.latest_id = PlayerConnections.ID\r\n                WHERE x = ? AND y = ? AND z = ?\r\n                ORDER BY \\`block_history\\`.\\`tick\\` DESC`,\r\n        values: [Math.floor(pos.x), Math.floor(pos.y), Math.floor(pos.z)]\r\n    }\r\n    try {\r\n        const response = await DB.query(request);\r\n        if(!response.result[0]?.x && response.result != \"\"){\r\n            sendMessage('§c critical Mysql error. Contact admins for fix', 'BlockHistory', sender)\r\n            sendLogMessage(JSON.stringify(response.result))\r\n            return;\r\n        }\r\n        if(printBlockHistory(response, {type: \"block\", pos: pos}, sender)){\r\n            if(lastParticleCall[sender.id])delete lastParticleCall[sender.id]\r\n            sendMessage(`you can use !bh show to see these changes using particles`, \"cmd - BlockHistory\", sender)\r\n            lastParticleCall[sender.id] = {\r\n                callback: () => {\r\n                    getEdgeLocations(response.result, (loc,axis) => {\r\n                        addActiveParticles(loc,axis,sender);\r\n                    })\r\n                }\r\n            }\r\n        }\r\n    }\r\n    catch (error) {\r\n        sendMessage(`${error}`,'CMD - BlockHistory',sender);\r\n    }\r\n}\r\n\r\nasync function reverseBlocks(blocks, sender) {\r\n    const callID = (await getMaxIDPerPlayer(BlockHistoryUpdateTypes.blockHistoryReverse, sender) ?? -1)+1\r\n    for(let i = 0;i<blocks.length;i++){\r\n        const playerId = sender.id;\r\n        const block = world.getDimension(blocks[i].dimension_id).getBlock(blocks[i]);\r\n        const blockOld = Blocks.copyBlockState(block,true);\r\n        const permutationsBefore = BlockPermutation.resolve(blocks[i].before_id, JSON.parse(blocks[i].before_permutations))\r\n        block.setType(MinecraftBlockTypes.get(blocks[i].before_id));\r\n        block.setPermutation(permutationsBefore);\r\n        BlockHistoryPlugin.saveBlockUpdate({\r\n            before: blockOld,\r\n            after: Blocks.copyBlockState(block,true)\r\n        },{\r\n            actorId: playerId,\r\n            updateType: BlockHistoryUpdateTypes.blockHistoryReverse,\r\n            updateId: callID\r\n        });\r\n    }\r\n    sendMessage(`succesfully reversed blocks - callID: ${callID}`, \"BlockHistory: reverse\",sender)\r\n}\r\n"]}